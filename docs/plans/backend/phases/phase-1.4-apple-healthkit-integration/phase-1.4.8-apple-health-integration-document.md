# Phase 1.4.8: Apple Health Integration Document

**Parent Goal:** Phase 1.4 Apple HealthKit Integration
**Checklist:**
- [x] 1.4.1 HealthKit Entitlements & Permissions (iOS)
- [x] 1.4.2 Swift HealthKit Bridge
- [x] 1.4.3 Flutter Platform Channel
- [x] 1.4.4 HealthKit MCP Server (Cloud Brain)
- [x] 1.4.5 Edge Agent Health Repository
- [x] 1.4.6 Background Observation
- [x] 1.4.7 Harness Test: HealthKit Integration
- [ ] 1.4.8 Apple Health Integration Document

---

## What
Create a "Living Document" that acts as the source of truth for all things Apple Health in our system. It consolidates technical details, constraints, and testing procedures.

## Why
HealthKit is complex, with many specific types, permission rules, and background behaviors. Having a central reference doc prevents knowledge loss and helps new engineers (or AI agents) understand how the integration works without digging through 10 files.

## How
Create a markdown file in `docs/plans/backend/integrations/` populated with structured sections.

## Features
- **API Overview:** Capabilities and Limitations.
- **Data Dictionary:** Mapping of our metric names to HKObjectTypes.
- **Troubleshooting:** what to do if permissions fail.

## Files
- Create: `docs/plans/backend/integrations/apple-health-integration.md`

## Steps

1. **Create integration reference document**

Create the file `docs/plans/backend/integrations/apple-health-integration.md` with:

```markdown
# Apple Health Integration Reference

## Overview
We integrate with HealthKit to read passive activity data (Steps, Workouts) and write nutrition/activity data generated by the AI.

## Architecture
- **Swift Bridge:** Direct HKHealthStore access.
- **Platform Channel:** `com.zuralog/health`
- **MCP Server:** `apple_health` (Cloud Brain) -> Edge Agent

## Data Types Supported
| Metric | HKType | Read/Write |
|--------|--------|------------|
| Steps | `stepCount` | Read |
| Workouts | `workoutType` | Read/Write |
| Calories (Active) | `activeEnergyBurned` | Read |
| Calories (Diet) | `dietaryEnergyConsumed` | Read/Write |
| Weight | `bodyMass` | Read/Write |

## Permissions
Listed in `Info.plist`. We request "Share" and "Read" permissions on first integration.

## Background Updates
We use `HKObserverQuery` for:
- Steps
- Workouts

When triggered, the app (if alive) is notified via method channel.

## Testing
1. Use iPhone Simulator (Health app is installed).
2. Manually add data in Health App.
3. Use `Harness Screen` to read it back.
```

## Exit Criteria
- `apple-health-integration.md` exists and is populated.
